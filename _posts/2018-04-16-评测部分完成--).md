---
author: wulei
comments: true
date: 2018-04-16 22:32:00+00:00
link: http://wulei.kim/2018/04/16/oj-server-finish/
slug: oj-server-finish
title: 评测部分完成 :-)
tags:
- OJ
---

今天终于把评测机部分全部写完，调了一天多的Bug，贼累，不过最后很开心。评测服务程序通过Socket与Web端连接，自定义传输协议，传输评测文件和评测结果。接下来可以进入Web部分的开发了。记一下今天遇到的几个Bug：

+ 评测服务程序fork一个子进程来运行评测核心程序，但是会出现fork一次参数特别多子进程的情况，甚至还把电脑弄死机了两次，百思不得其解，还特地仔细的重看了两遍fork的相关用法。最后发现是一个特别傻逼的错误，就是在子进程最后没有加exit()函数，使得子进程不会退出，继而无限的往下fork。所以，记得**fork完之后子进程要退出！**
+ 还是评测服务程序fork子进程来运行评测核心程序的地方，调用execv函数时总是失败，因为execv函数传递的是一个参数数组，可是用自己组装的数组传递进去总是报bad adress错误。仔细看了一遍Man Pages中对exec函数族的说明，发现参数数组必须以NULL结尾，这一点我以前从不知道，所以**读文档很重要！**
+ 评测核心程序运行完之后服务程序会根据核心程序的退出码判断评测结果并将结果返回给Web端，但是添加上返回的代码后整个程序就会阻塞，找了很久，发现是前部分接收文件的时候使用recv()函数的返回结果来控制循环，导致Web端接收时服务端就会一直阻塞。

[GitHub](https://github.com/wuleiaty/online-judge)
